#-------------------------------------------------------------------------------
# Copyright 2019 Dominik Salvet
# SPDX-License-Identifier: MIT
# https://github.com/dominiksalvet/gitpack
#-------------------------------------------------------------------------------

os: linux
dist: xenial
language: shell

jobs:
  include:
    - stage: Initialization
      name: Scripts
      before_script: shellcheck --version
      script: shellcheck .ci/*.sh

    - stage: Checks
      name: Static analysis
      before_script: shellcheck --version
      script: shellcheck src/gitpack

    - name: Code style
      script: .ci/checks-code-style.sh

    - name: Licensing
      services: docker
      install: docker pull fsfe/reuse:latest
      before_script: docker run fsfe/reuse reuse --version
      script: docker run -v "$TRAVIS_BUILD_DIR":/repo fsfe/reuse sh -c 'cd /repo && reuse lint'

    - stage: Installation
      name: Global
      script: .ci/installation-global.sh || .ci/dump.sh global "$?"

    - name: Local
      script: .ci/installation-local.sh || .ci/dump.sh local "$?"

    - stage: Tests
      name: Execution
      install: src/gitpack install github.com/dominiksalvet/gitpack="$TRAVIS_COMMIT"
      script: .ci/tests-execution.sh || .ci/dump.sh local "$?"

    - name: Usage
      install: src/gitpack install github.com/dominiksalvet/gitpack="$TRAVIS_COMMIT"
      script: .ci/tests-usage.sh || .ci/dump.sh local "$?"

    - name: Logging
      install: src/gitpack install github.com/dominiksalvet/gitpack="$TRAVIS_COMMIT"
      script: .ci/tests-logging.sh || .ci/dump.sh local "$?"
